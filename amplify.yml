version: 1
frontend:
  phases:
    preBuild:
      commands:
        - 'corepack enable'
        - 'npx --yes pnpm i'
    build:
      commands:
        - '[ -n "${AWS_PULL_REQUEST_ID}" ] && [ "${AWS_BRANCH}" = "dev" ] &&
          echo "PR from dev to main detected, using NUXT_SITE_ENV=staging pnpm
          build" && NUXT_SITE_ENV=staging pnpm build || true'
        - '[ -n "${AWS_PULL_REQUEST_ID}" ] && [ "${AWS_BRANCH}" != "dev" ] &&
          echo "PR to dev detected, using pnpm build:test" && pnpm "build:test"
          || true'
        - '[ -z "${AWS_PULL_REQUEST_ID}" ] && [ "${AWS_BRANCH}" = "main" ] &&
          echo "Building main branch, using pnpm build" && pnpm build || true'
        - '[ -z "${AWS_PULL_REQUEST_ID}" ] && [ "${AWS_BRANCH}" != "main" ] &&
          echo "Building non-main branch, using pnpm build:test" && pnpm
          "build:test" || true'
    postBuild:
      commands:
        - "echo 'Build completed for ${AWS_BRANCH} (PR ID:
          ${AWS_PULL_REQUEST_ID:-none})'"
  artifacts:
    baseDirectory: .vitepress/dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
